<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Option B: Rich Chat (No Graph)</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: #0a0a0f; color: #e2e8f0; height: 100vh; display: flex; flex-direction: column; }

  .toolbar { display: flex; align-items: center; justify-content: space-between; padding: 8px 16px; background: #111118; border-bottom: 1px solid #1e1e2e; }
  .toolbar h1 { font-size: 13px; font-weight: 600; color: #94a3b8; }

  .chat-container { flex: 1; overflow-y: auto; padding: 24px 0; display: flex; flex-direction: column; align-items: center; }
  .chat-inner { width: 100%; max-width: 720px; display: flex; flex-direction: column; gap: 20px; padding: 0 24px; }

  /* Message blocks */
  .message-block { display: flex; flex-direction: column; gap: 6px; }
  .message-block.user { align-items: flex-end; }
  .message-block.agent { align-items: flex-start; }

  .sender { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; padding: 0 4px; }
  .sender.user-label { color: #60a5fa; }
  .sender.agent-label { color: #34d399; }

  .bubble { padding: 12px 16px; border-radius: 12px; font-size: 14px; line-height: 1.6; max-width: 85%; }
  .bubble.user { background: #1e3a5f; color: #bfdbfe; border-bottom-right-radius: 4px; }
  .bubble.agent { background: #12121e; border: 1px solid #222236; color: #cbd5e1; border-bottom-left-radius: 4px; }

  /* Tool call cards */
  .tool-group { display: flex; flex-direction: column; gap: 6px; width: 100%; max-width: 560px; }

  .tool-card { background: #111118; border: 1px solid #2a2a3e; border-radius: 10px; overflow: hidden; transition: border-color 0.2s; cursor: pointer; }
  .tool-card:hover { border-color: #3b3b5e; }
  .tool-card.expanded .tool-detail { display: block; }

  .tool-header { display: flex; align-items: center; gap: 10px; padding: 10px 14px; }
  .tool-icon { width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; flex-shrink: 0; }
  .tool-icon.read { background: #1e1b4b; color: #818cf8; }
  .tool-icon.write { background: #14532d; color: #4ade80; }
  .tool-icon.term { background: #3b0764; color: #c084fc; }
  .tool-icon.search { background: #713f12; color: #fbbf24; }

  .tool-info { flex: 1; min-width: 0; }
  .tool-name { font-size: 12px; font-weight: 600; color: #e2e8f0; }
  .tool-desc { font-size: 11px; color: #64748b; margin-top: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

  .tool-status { display: flex; align-items: center; gap: 6px; }
  .tool-badge { font-size: 10px; padding: 2px 8px; border-radius: 9999px; font-weight: 600; }
  .tool-badge.success { background: #052e16; color: #4ade80; }
  .tool-badge.error { background: #450a0a; color: #fca5a5; }
  .tool-badge.running { background: #1e1b4b; color: #818cf8; animation: pulse 1.5s infinite; }
  @keyframes pulse { 0%,100% { opacity:1 } 50% { opacity:0.5 } }
  .tool-duration { font-size: 10px; color: #475569; }

  .tool-detail { display: none; border-top: 1px solid #1e1e2e; padding: 10px 14px; }
  .tool-detail pre { background: #0a0a0f; padding: 10px; border-radius: 6px; font-size: 11px; font-family: 'SF Mono', Monaco, monospace; color: #94a3b8; overflow-x: auto; white-space: pre-wrap; line-height: 1.5; }
  .tool-detail .section-label { font-size: 10px; color: #475569; text-transform: uppercase; font-weight: 600; margin-bottom: 4px; margin-top: 8px; }
  .tool-detail .section-label:first-child { margin-top: 0; }

  /* Subagent cards */
  .subagent-group { display: flex; gap: 8px; width: 100%; max-width: 560px; }

  .subagent-card { flex: 1; background: #111118; border: 1px solid #2a2a3e; border-radius: 10px; padding: 12px; cursor: pointer; transition: border-color 0.2s; }
  .subagent-card:hover { border-color: #3b3b5e; }
  .subagent-card.success { border-left: 3px solid #22c55e; }
  .subagent-card.running { border-left: 3px solid #818cf8; }

  .sub-header { display: flex; align-items: center; gap: 6px; margin-bottom: 6px; }
  .sub-type { font-size: 10px; font-weight: 700; text-transform: uppercase; padding: 1px 6px; border-radius: 4px; }
  .sub-type.explore { background: #1e3a5f; color: #60a5fa; }
  .sub-type.plan { background: #1a2e05; color: #a3e635; }
  .sub-type.code { background: #2e1065; color: #a78bfa; }
  .sub-status { font-size: 10px; color: #22c55e; margin-left: auto; }

  .sub-desc { font-size: 12px; color: #94a3b8; line-height: 1.4; }
  .sub-preview { font-size: 11px; color: #64748b; margin-top: 6px; border-top: 1px solid #1e1e2e; padding-top: 6px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

  /* Metrics bar */
  .metrics-bar { display: flex; gap: 8px; padding: 4px 0; flex-wrap: wrap; }
  .metric { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; background: #111118; border: 1px solid #1e1e2e; border-radius: 6px; font-size: 11px; color: #64748b; }
  .metric .val { color: #94a3b8; font-weight: 600; }

  /* Streaming indicator */
  .streaming { display: flex; align-items: center; gap: 8px; padding: 8px 0; }
  .streaming-dots { display: flex; gap: 3px; }
  .streaming-dots span { width: 6px; height: 6px; border-radius: 50%; background: #34d399; animation: bounce 1.2s infinite; }
  .streaming-dots span:nth-child(2) { animation-delay: 0.15s; }
  .streaming-dots span:nth-child(3) { animation-delay: 0.3s; }
  @keyframes bounce { 0%,80%,100% { transform:translateY(0) } 40% { transform:translateY(-6px) } }
  .streaming-text { font-size: 12px; color: #475569; }

  /* Input */
  .chat-input { padding: 16px 24px; border-top: 1px solid #1e1e2e; display: flex; justify-content: center; }
  .input-wrap { width: 100%; max-width: 720px; position: relative; }
  .input-wrap input { width: 100%; background: #111118; border: 1px solid #2a2a3e; border-radius: 12px; padding: 12px 50px 12px 16px; color: #e2e8f0; font-size: 14px; outline: none; }
  .input-wrap input:focus { border-color: #3b82f6; }
  .input-wrap button { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: #3b82f6; border: none; border-radius: 8px; width: 32px; height: 32px; color: white; cursor: pointer; font-size: 14px; }
</style>
</head>
<body>

<div class="toolbar">
  <h1>Option B: Rich Chat &mdash; No Separate Graph</h1>
</div>

<div class="chat-container">
  <div class="chat-inner">

    <!-- Turn 1 -->
    <div class="message-block user">
      <span class="sender user-label">You</span>
      <div class="bubble user">Fix the login bug in auth.ts</div>
    </div>

    <div class="message-block agent">
      <span class="sender agent-label">Agent</span>
      <div class="bubble agent">Let me explore the auth module and fix the login bug. I'll read the file first.</div>

      <!-- Tool calls inline -->
      <div class="tool-group">
        <div class="tool-card" onclick="this.classList.toggle('expanded')">
          <div class="tool-header">
            <div class="tool-icon read">R</div>
            <div class="tool-info">
              <div class="tool-name">read_file</div>
              <div class="tool-desc">src/auth.ts</div>
            </div>
            <div class="tool-status">
              <span class="tool-badge success">success</span>
              <span class="tool-duration">0.6s</span>
            </div>
          </div>
          <div class="tool-detail">
            <div class="section-label">Output</div>
            <pre>export async function login(email, password) {
  const user = await db.findUser(email)
  if (user.password === password) {  // BUG: plain text compare
    return createSession(user)
  }
  throw new AuthError('Invalid credentials')
}</pre>
          </div>
        </div>

        <div class="tool-card" onclick="this.classList.toggle('expanded')">
          <div class="tool-header">
            <div class="tool-icon write">W</div>
            <div class="tool-info">
              <div class="tool-name">write_file</div>
              <div class="tool-desc">src/auth.ts &mdash; fix bcrypt comparison</div>
            </div>
            <div class="tool-status">
              <span class="tool-badge success">success</span>
              <span class="tool-duration">0.7s</span>
            </div>
          </div>
          <div class="tool-detail">
            <div class="section-label">Diff</div>
            <pre><span style="color:#f87171">- if (user.password === password) {</span>
<span style="color:#4ade80">+ if (await bcrypt.compare(password, user.hash)) {</span></pre>
          </div>
        </div>
      </div>

      <div class="bubble agent" style="margin-top:4px;">
        Fixed the login bug. The issue was a plain-text password comparison &mdash; I replaced it with <code style="background:#1e1b4b;padding:1px 5px;border-radius:3px;font-size:12px;">bcrypt.compare()</code>.
      </div>
      <div class="metrics-bar">
        <div class="metric">Tokens: <span class="val">1,230</span></div>
        <div class="metric">Duration: <span class="val">3.2s</span></div>
        <div class="metric">Cost: <span class="val">$0.004</span></div>
      </div>
    </div>

    <!-- Turn 2 -->
    <div class="message-block user">
      <span class="sender user-label">You</span>
      <div class="bubble user">Now add rate limiting to the login endpoint</div>
    </div>

    <div class="message-block agent">
      <span class="sender agent-label">Agent</span>
      <div class="bubble agent">I'll implement rate limiting. Let me check the existing middleware and design the approach.</div>

      <!-- Parallel subagents -->
      <div class="subagent-group">
        <div class="subagent-card success">
          <div class="sub-header">
            <span class="sub-type explore">Explore</span>
            <span class="sub-status">&#10003; 1.0s</span>
          </div>
          <div class="sub-desc">Check existing middleware</div>
          <div class="sub-preview">Found middleware.ts with CORS and auth middleware. No existing rate limiting.</div>
        </div>

        <div class="subagent-card success">
          <div class="sub-header">
            <span class="sub-type plan">Plan</span>
            <span class="sub-status">&#10003; 1.3s</span>
          </div>
          <div class="sub-desc">Design rate limit approach</div>
          <div class="sub-preview">Use express-rate-limit: 5 attempts per 15 min window on /auth/login</div>
        </div>
      </div>

      <!-- More tool calls -->
      <div class="tool-group">
        <div class="tool-card" onclick="this.classList.toggle('expanded')">
          <div class="tool-header">
            <div class="tool-icon term">$</div>
            <div class="tool-info">
              <div class="tool-name">terminal</div>
              <div class="tool-desc">npm install express-rate-limit</div>
            </div>
            <div class="tool-status">
              <span class="tool-badge success">success</span>
              <span class="tool-duration">0.8s</span>
            </div>
          </div>
          <div class="tool-detail">
            <div class="section-label">Output</div>
            <pre>added 1 package in 2.3s

1 package is looking for funding
  run `npm fund` for details</pre>
          </div>
        </div>

        <div class="tool-card" onclick="this.classList.toggle('expanded')">
          <div class="tool-header">
            <div class="tool-icon write">W</div>
            <div class="tool-info">
              <div class="tool-name">write_file</div>
              <div class="tool-desc">src/middleware/rate-limit.ts</div>
            </div>
            <div class="tool-status">
              <span class="tool-badge success">success</span>
              <span class="tool-duration">0.6s</span>
            </div>
          </div>
          <div class="tool-detail">
            <div class="section-label">Created file</div>
            <pre>import rateLimit from 'express-rate-limit'

export const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 5,
  message: { error: 'Too many login attempts' },
  standardHeaders: true,
})</pre>
          </div>
        </div>

        <div class="tool-card" onclick="this.classList.toggle('expanded')">
          <div class="tool-header">
            <div class="tool-icon write">W</div>
            <div class="tool-info">
              <div class="tool-name">write_file</div>
              <div class="tool-desc">src/routes/auth.ts &mdash; apply limiter</div>
            </div>
            <div class="tool-status">
              <span class="tool-badge success">success</span>
              <span class="tool-duration">0.5s</span>
            </div>
          </div>
          <div class="tool-detail">
            <div class="section-label">Diff</div>
            <pre><span style="color:#4ade80">+ import { loginLimiter } from '../middleware/rate-limit'</span>

<span style="color:#f87171">- router.post('/login', loginHandler)</span>
<span style="color:#4ade80">+ router.post('/login', loginLimiter, loginHandler)</span></pre>
          </div>
        </div>
      </div>

      <div class="bubble agent" style="margin-top:4px;">
        Rate limiting is now active on the login endpoint. It allows 5 attempts per 15-minute window, with standard rate limit headers included in responses.
      </div>
      <div class="metrics-bar">
        <div class="metric">Tokens: <span class="val">3,000</span></div>
        <div class="metric">Duration: <span class="val">3.6s</span></div>
        <div class="metric">Cost: <span class="val">$0.008</span></div>
      </div>
    </div>

    <!-- Currently streaming -->
    <div class="message-block user">
      <span class="sender user-label">You</span>
      <div class="bubble user">Add tests for the rate limiter</div>
    </div>

    <div class="message-block agent">
      <span class="sender agent-label">Agent</span>
      <div class="bubble agent">I'll write tests for the rate limiting middleware using Jest and supertest...</div>

      <div class="tool-group">
        <div class="tool-card">
          <div class="tool-header">
            <div class="tool-icon search">S</div>
            <div class="tool-info">
              <div class="tool-name">search_files</div>
              <div class="tool-desc">Looking for existing test patterns...</div>
            </div>
            <div class="tool-status">
              <span class="tool-badge running">running</span>
            </div>
          </div>
        </div>
      </div>

      <div class="streaming">
        <div class="streaming-dots"><span></span><span></span><span></span></div>
        <span class="streaming-text">Agent is working...</span>
      </div>
    </div>

  </div>
</div>

<div class="chat-input">
  <div class="input-wrap">
    <input type="text" placeholder="Send a message..." />
    <button>&uarr;</button>
  </div>
</div>

</body>
</html>
