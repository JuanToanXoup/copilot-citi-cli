name = "Orchestrator"
description = "Multi-agent orchestrator that decomposes tasks and delegates to specialised workers."
model = "gpt-4.1"
transport = "mcp"       # "mcp" (workers as child processes) or "queue" (in-process threads)
#workspace_root = "~/IdeaProjects/my-project"

#[proxy]
#url = "http://webproxy.example.com:8080"
#no_ssl_verify = false

system_prompt = """
You are an orchestrator agent. Your job is to decompose complex software \
engineering tasks into discrete subtasks and delegate them to specialised \
worker agents. You plan, coordinate, and aggregate results.

Available worker roles:
- coder: Reads/writes code, runs commands, implements features
- reviewer: Reviews code for bugs, style, and security (read-only)
- tester: Writes and runs tests, reports coverage

When given a high-level goal, produce a structured plan as a JSON array \
of subtask assignments. Each element must have:
- "worker_role": one of the available roles
- "task": clear, self-contained description
- "depends_on": list of task indices that must complete first, or []

After all workers complete, summarise the overall results.
"""

# MCP servers (uncomment to override defaults)
#[mcp_servers.playwright]
#command = "npx"
#args = ["-y", "@playwright/mcp@latest"]

# LSP servers (uncomment to override defaults from config.toml)
#[lsp_servers.python]
#command = "npx"
#args = ["-y", "pyright", "--langserver", "--stdio"]

# ── Worker agents ─────────────────────────────────────────────────────────────
# Each [[workers]] block defines a worker agent. The orchestrator spawns all
# of them at startup and delegates subtasks by role.
#
# Per-worker overrides (all optional — omit to inherit from orchestrator):
#   workspace_root    — separate workspace directory
#   proxy_url         — different proxy
#   no_ssl_verify     — SSL bypass
#   tools_enabled     — "__ALL__" or a list of tool names
#   mcp_servers       — MCP server config dict
#   lsp_servers       — LSP server config dict
#   question_schema   — structured input contract (descriptive, not strict)
#   answer_schema     — structured output contract (soft-validated)

[[workers]]
role = "coder"
agent_mode = true
# model = "gpt-4.1"           # omit to inherit from orchestrator
# workspace_root = "~/other"  # omit to inherit from orchestrator
# proxy_url = ""              # omit to inherit from orchestrator
# no_ssl_verify = false       # omit to inherit from orchestrator
# tools_enabled = "__ALL__"
system_prompt = """
You are a skilled software engineer. Read code, understand the codebase, \
make edits, and run commands as needed. Focus on clean, working \
implementations.
"""

# Q&A schemas define the structured contract between orchestrator and worker.
# Schemas are descriptive (guiding the LLMs) — mismatches produce warnings,
# never hard failures. Extra fields are always preserved.
#
# [workers.question_schema]
# file_path = { type = "string", required = true, description = "File to modify" }
# instructions = { type = "string", required = true, description = "What to implement" }
#
# [workers.answer_schema]
# files_changed = { type = "array", description = "List of modified file paths" }
# summary = { type = "string", description = "What was done" }

[[workers]]
role = "reviewer"
agent_mode = true
tools_enabled = [
    "read_file", "list_dir", "file_search", "grep_search",
    "get_errors", "search_workspace_symbols", "list_code_usages",
    "get_changed_files", "get_project_setup_info",
]
system_prompt = """
You are a code review expert. Examine code for bugs, style issues, \
security vulnerabilities, and suggest improvements. Do NOT edit files — \
only report findings.
"""

# Example: reviewer with a structured answer contract
[workers.question_schema]
file_path = { type = "string", required = true, description = "Path to the file to review" }
diff = { type = "string", description = "The diff or changes to review" }
focus = { type = "string", description = "What aspect to focus the review on" }

[workers.answer_schema]
approved = { type = "boolean", description = "Whether the code is approved" }
issues = { type = "array", description = "List of issues found" }
summary = { type = "string", description = "Overall review summary" }

[[workers]]
role = "tester"
agent_mode = true
system_prompt = """
You are a testing specialist. Write comprehensive tests, run the test \
suite, and report results. Ensure good coverage of edge cases and \
failure modes.
"""
