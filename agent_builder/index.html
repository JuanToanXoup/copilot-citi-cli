<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Builder</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
<div class="app">
    <!-- Header -->
    <div class="header">
        <div class="header-title">
            <span class="marker">&#x23FA;</span> Agent Builder
        </div>
        <div class="header-actions">
            <button class="btn" id="btn-load" title="Load saved config">Load</button>
            <button class="btn" id="btn-save" title="Save current config">Save</button>
            <button class="btn" id="btn-export-script" title="Export as .py script">Export Script</button>
            <button class="btn btn-primary" id="btn-build" title="Build PyInstaller binary">Build</button>
        </div>
    </div>

    <!-- Main layout -->
    <div class="main">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Agent Config (always visible) -->
            <div class="sidebar-config">
                <div class="field">
                    <label for="agent-name">Name</label>
                    <input type="text" id="agent-name" placeholder="my-agent">
                </div>
                <div class="field">
                    <label for="agent-desc">Description</label>
                    <input type="text" id="agent-desc" placeholder="What this agent does...">
                </div>
                <div class="field">
                    <label for="agent-model">Model</label>
                    <select id="agent-model">
                        <option value="gpt-4.1">gpt-4.1</option>
                    </select>
                </div>
                <div class="field">
                    <label for="agent-template">Template</label>
                    <select id="agent-template">
                        <option value="">— None —</option>
                    </select>
                </div>
                <div class="field">
                    <label for="agent-workspace">Workspace</label>
                    <input type="text" id="agent-workspace" placeholder="/path/to/project">
                </div>
            </div>

            <!-- Tab bar -->
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="tools">
                    Tools <span class="tab-badge" id="tool-count">0/0</span>
                </button>
                <button class="sidebar-tab" data-tab="mcp">
                    MCP <span class="tab-badge" id="mcp-count">0</span>
                </button>
                <button class="sidebar-tab" data-tab="lsp">
                    LSP <span class="tab-badge" id="lsp-count">0</span>
                </button>
            </div>

            <!-- Tab panels -->
            <div class="sidebar-tab-panels">
                <!-- Tools panel -->
                <div class="tab-panel active" data-panel="tools">
                    <input type="text" class="tool-search" id="tool-search"
                        placeholder="Filter tools...">
                    <div class="tool-actions">
                        <button class="btn btn-sm" id="btn-select-all">Select All</button>
                        <button class="btn btn-sm" id="btn-clear-all">Clear All</button>
                    </div>
                    <div id="tool-list"></div>
                </div>

                <!-- MCP panel -->
                <div class="tab-panel" data-panel="mcp">
                    <div id="mcp-server-list" class="server-list"></div>
                    <div class="add-server-form" id="mcp-add-form">
                        <div class="field">
                            <label>Server Name</label>
                            <input type="text" id="mcp-name" placeholder="playwright">
                        </div>
                        <div class="field">
                            <label>Command</label>
                            <input type="text" id="mcp-command" placeholder="npx">
                        </div>
                        <div class="field">
                            <label>Args (comma-separated)</label>
                            <input type="text" id="mcp-args" placeholder="-y, @playwright/mcp@latest">
                        </div>
                        <button class="btn btn-sm" id="btn-add-mcp">+ Add MCP Server</button>
                    </div>
                </div>

                <!-- LSP panel -->
                <div class="tab-panel" data-panel="lsp">
                    <div id="lsp-server-list" class="server-list"></div>
                    <div class="add-server-form" id="lsp-add-form">
                        <div class="field">
                            <label>Language ID</label>
                            <input type="text" id="lsp-lang" placeholder="python">
                        </div>
                        <div class="field">
                            <label>Command</label>
                            <input type="text" id="lsp-command" placeholder="pyright-langserver">
                        </div>
                        <div class="field">
                            <label>Args (comma-separated)</label>
                            <input type="text" id="lsp-args" placeholder="--stdio">
                        </div>
                        <button class="btn btn-sm" id="btn-add-lsp">+ Add LSP Server</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resize handle -->
        <div class="resize-handle" id="resize-handle"></div>

        <!-- Content -->
        <div class="content">
            <!-- System Prompt -->
            <div class="prompt-section">
                <h3>System Prompt</h3>
                <textarea class="prompt-textarea" id="system-prompt"
                    placeholder="You are a helpful assistant that..."></textarea>
            </div>

            <!-- Chat Preview -->
            <div class="chat-section">
                <div class="chat-header">
                    <h3>Live Chat Preview</h3>
                    <div class="flex-row">
                        <span class="text-sm text-muted" id="session-status">No session</span>
                        <button class="btn btn-sm" id="btn-new-session">New Session</button>
                    </div>
                </div>
                <div class="chat-messages" id="chat-messages"></div>
                <div class="chat-input-row">
                    <input type="text" id="chat-input" placeholder="Type a message to test your agent...">
                    <button class="btn btn-primary btn-sm" id="btn-send">Send</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Load Modal -->
<div class="modal-overlay" id="load-modal">
    <div class="modal">
        <h3>Load Agent Config</h3>
        <div id="config-list" class="config-list"></div>
        <div class="flex-row mt-8" style="justify-content: flex-end;">
            <button class="btn btn-sm" id="btn-load-cancel">Cancel</button>
        </div>
    </div>
</div>

<!-- Build Overlay -->
<div class="build-overlay" id="build-overlay">
    <div class="build-dialog">
        <h3 id="build-title">Building Agent...</h3>
        <div class="build-log" id="build-log"></div>
        <div class="flex-row" style="justify-content: flex-end;">
            <button class="btn btn-sm" id="btn-build-close" disabled>Close</button>
        </div>
    </div>
</div>

<script src="/api.js"></script>
<script src="/components.js"></script>
<script src="/app.js"></script>
</body>
</html>
