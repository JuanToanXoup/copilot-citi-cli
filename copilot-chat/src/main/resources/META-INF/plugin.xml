<idea-plugin>
    <id>com.citigroup.copilotchat</id>
    <name>Copilot Chat</name>
    <vendor>Citigroup</vendor>
    <description><![CDATA[
<p>Native IntelliJ chat interface for GitHub Copilot, powered by copilot-language-server.</p>
<ul>
    <li>Spawns copilot-language-server directly via LSP JSON-RPC</li>
    <li>19 PSI-powered code intelligence tools (find usages, type hierarchy, diagnostics, etc.)</li>
    <li>24 built-in tools (file ops, search, terminal, web) as fallback</li>
    <li>Supports agent mode with tool calling and collapsible tool call display</li>
    <li>MCP server configuration (Playwright, custom servers)</li>
    <li>Worker agents with orchestration</li>
    <li>Markdown rendering with IDE theme integration</li>
</ul>
]]>    </description>

    <!-- Platform dependency -->
    <depends>com.intellij.modules.platform</depends>
    <!-- Optional: enables PSI-powered code intelligence tools (Java/Kotlin) -->
    <depends optional="true" config-file="java-psi-tools.xml">com.intellij.modules.java</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Project-level LSP Client Pool — manages LSP processes partitioned by tool set -->
        <projectService serviceImplementation="com.citigroup.copilotchat.lsp.LspClientPool"/>

        <!-- Application-level Settings -->
        <applicationService serviceImplementation="com.citigroup.copilotchat.config.CopilotChatSettings"/>

        <!-- Project-level Conversation Manager -->
        <projectService serviceImplementation="com.citigroup.copilotchat.conversation.ConversationManager"/>

        <!-- Project-level LSP Client Factory — creates initialized clients for agents -->
        <projectService serviceImplementation="com.citigroup.copilotchat.lsp.LspClientFactory"/>

        <!-- Project-level Agent Service (Claude Code architecture) -->
        <projectService serviceImplementation="com.citigroup.copilotchat.agent.AgentService"/>

        <!-- Project-level Team Service (agent team communication) -->
        <projectService serviceImplementation="com.citigroup.copilotchat.agent.TeamService"/>

        <!-- RAG: In-memory vector store with file persistence -->
        <applicationService serviceImplementation="com.citigroup.copilotchat.rag.VectorStore"/>

        <!-- RAG: Background indexing service -->
        <projectService serviceImplementation="com.citigroup.copilotchat.rag.RagIndexer"/>

        <!-- RAG: Query pipeline -->
        <projectService serviceImplementation="com.citigroup.copilotchat.rag.RagQueryService"/>

        <!-- Working Set: tracks agent file changes for accept/revert -->
        <projectService serviceImplementation="com.citigroup.copilotchat.workingset.WorkingSetService"/>

        <!-- Copilot Commit: write-stage-restore git commit with Copilot attribution -->
        <projectService serviceImplementation="com.citigroup.copilotchat.workingset.CopilotCommitService"/>

        <!-- Notification group for commit attribution balloons -->
        <notificationGroup id="Copilot Chat" displayType="BALLOON"/>

        <!-- Commit hook: appends Co-authored-by when committing Copilot-changed files -->
        <checkinHandlerFactory implementation="com.citigroup.copilotchat.workingset.CopilotCheckinHandlerFactory"/>

        <!-- Tool Window with content tabs (Agent, Agents, Changes, Tools, MCP, Memory, Recorder) -->
        <toolWindow id="Copilot Chat"
                    anchor="right"
                    icon="com.citigroup.copilotchat.icons.CopilotChatIcons.ToolWindow"
                    factoryClass="com.citigroup.copilotchat.ui.ChatToolWindowFactory"
                    canCloseContents="false"/>
    </extensions>

    <actions>
        <group id="CopilotChat.Actions" text="Copilot Chat">
            <action id="CopilotChat.NewConversation"
                    class="com.citigroup.copilotchat.actions.NewConversationAction"
                    text="New Conversation"
                    description="Start a new chat conversation"/>
            <action id="CopilotChat.OpenAgentConfig"
                    class="com.citigroup.copilotchat.actions.OpenAgentConfigAction"
                    text="Open Agent Config"
                    description="Open the agent configuration file"/>
        </group>
    </actions>
</idea-plugin>
